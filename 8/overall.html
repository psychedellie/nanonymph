
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FASTQ Summary Report</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/modern-normalize/2.0.0/modern-normalize.min.css">
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f8f9fa; margin: 0; padding: 2em; }
        h1 { color: #2c3e50; }
        table { border-collapse: collapse; width: 100%; margin-bottom: 2em; background: #fff; }
        th, td { border: 1px solid #e1e4e8; padding: 0.75em 1em; text-align: center; }
        th { background: #f3f6fa; color: #34495e; }
        tr:nth-child(even) { background: #f9fafb; }
        a { color: #2980b9; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .chart-container { width: 100%; max-width: none; aspect-ratio: 4/1; }
        .row-charts-table { width: 100%; margin-bottom: 2em; background: none; border: none; }
        .row-charts-table td { border: none; vertical-align: top; width: 50%; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h2>FASTQ Aggregate Summary (fastplong)</h2>
    <table>
        <thead>
            <tr>
                <th>File</th>
                <th>Total Reads (Before)</th>
                <th>Total Reads (After)</th>
                <th>Total Bases (Before)</th>
                <th>Total Bases (After)</th>
                <th>Q20 Rate (Before)</th>
                <th>Q20 Rate (After)</th>
                <th>Q30 Rate (Before)</th>
                <th>Q30 Rate (After)</th>
                <th>GC Content (Before)</th>
                <th>GC Content (After)</th>
                <th>HTML Report</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
    <table class="row-charts-table">
        <tr>
            <td><div id="meanQualPlotBefore" style="width:100%;height:400px;"></div></td>
            <td><div id="meanQualPlotAfter" style="width:100%;height:400px;"></div></td>
        </tr>
        <tr>
            <td><div id="gcCurvePlotBefore" style="width:100%;height:400px;"></div></td>
            <td><div id="gcCurvePlotAfter" style="width:100%;height:400px;"></div></td>
        </tr>
    </table>

    <div class="chart-container" style="width:100%; max-width:none; aspect-ratio: 4/1;">
        <canvas id="qRateChart" style="height:200px;"></canvas>
    </div>
    <script>
        const files = [];
        const totalReadsBefore = [];
        const totalReadsAfter = [];
        const totalBasesBefore = [];
        const totalBasesAfter = [];
        const q20Before = [];
        const q20After = [];
        const q30Before = [];
        const q30After = [];
        // Plotly mean quality curves (before)
        const meanQualCurves = [];
        const maxLenBefore = 0;
        const maxLenAfter = 0;
        const qualLabelsBefore = Array.from({length: maxLenBefore}, (_, i) => i + 1);
        const qualLabelsAfter = Array.from({length: maxLenAfter}, (_, i) => i + 1);
        const plotlyTracesBefore = meanQualCurves.map((item, idx) => {
            const before = item.curve_before || [];
            const beforePad = before.concat(Array(maxLenBefore - before.length).fill(null));
            return {
                x: qualLabelsBefore,
                y: beforePad,
                mode: 'lines',
                name: item.file,
                line: { width: 1 }
            };
        });
        Plotly.newPlot('meanQualPlotBefore', plotlyTracesBefore, {
            title: 'Mean Quality Curve (Read1, Before Filtering)',
            xaxis: { title: '' },
            yaxis: { title: 'Mean Quality', rangemode: 'tozero' },
            legend: { orientation: 'h' },
            margin: { t: 50, l: 60, r: 30, b: 60 }
        }, {responsive: true});
        // Plotly mean quality curves (after)
        const plotlyTracesAfter = meanQualCurves.map((item, idx) => {
            const after = item.curve_after || [];
            const afterPad = after.concat(Array(maxLenAfter - after.length).fill(null));
            return {
                x: qualLabelsAfter,
                y: afterPad,
                mode: 'lines',
                name: item.file,
                line: { width: 1 }
            };
        });
        Plotly.newPlot('meanQualPlotAfter', plotlyTracesAfter, {
            title: 'Mean Quality Curve (Read1, After Filtering)',
            xaxis: { title: '' },
            yaxis: { title: 'Mean Quality', rangemode: 'tozero' },
            legend: { orientation: 'h' },
            margin: { t: 50, l: 60, r: 30, b: 60 }
        }, {responsive: true});
        // Plotly GC content curves (before)
        const gcCurves = [];
        const maxLenGCBefore = 0;
        const maxLenGCAfter = 0;
        const gcLabelsBefore = Array.from({length: maxLenGCBefore}, (_, i) => i + 1);
        const gcLabelsAfter = Array.from({length: maxLenGCAfter}, (_, i) => i + 1);
        const plotlyTracesGCBefore = gcCurves.map((item, idx) => {
            const before = item.curve_before || [];
            const beforePad = before.concat(Array(maxLenGCBefore - before.length).fill(null));
            return {
                x: gcLabelsBefore,
                y: beforePad,
                mode: 'lines',
                name: item.file,
                line: { width: 1 }
            };
        });
        Plotly.newPlot('gcCurvePlotBefore', plotlyTracesGCBefore, {
            title: 'GC Content Curve (Read1, Before Filtering)',
            xaxis: { title: '' },
            yaxis: { title: 'GC %', rangemode: 'tozero' },
            legend: { orientation: 'h' },
            margin: { t: 50, l: 60, r: 30, b: 60 }
        }, {responsive: true});
        // Plotly GC content curves (after)
        const plotlyTracesGCAfter = gcCurves.map((item, idx) => {
            const after = item.curve_after || [];
            const afterPad = after.concat(Array(maxLenGCAfter - after.length).fill(null));
            return {
                x: gcLabelsAfter,
                y: afterPad,
                mode: 'lines',
                name: item.file,
                line: { width: 1 }
            };
        });
        Plotly.newPlot('gcCurvePlotAfter', plotlyTracesGCAfter, {
            title: 'GC Content Curve (Read1, After Filtering)',
            xaxis: { title: '' },
            yaxis: { title: 'GC %', rangemode: 'tozero' },
            legend: { orientation: 'h' },
            margin: { t: 50, l: 60, r: 30, b: 60 }
        }, {responsive: true});

        // Q20/Q30/Q40 chart (grouped bar)
        new Chart(document.getElementById('qRateChart'), {
            type: 'bar',
            data: {
                labels: files,
                datasets: [
                    { label: 'Q20 Rate (Before)', data: q20Before, backgroundColor: '#fab1a0' },
                    { label: 'Q20 Rate (After)', data: q20After, backgroundColor: '#e17055' },
                    { label: 'Q30 Rate (Before)', data: q30Before, backgroundColor: '#b2bec3' },
                    { label: 'Q30 Rate (After)', data: q30After, backgroundColor: '#2ecc71' }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'top' } },
                scales: { y: { beginAtZero: true, max: 100 } },
                animation: false
            }
        });
    </script>
</body>
</html>
